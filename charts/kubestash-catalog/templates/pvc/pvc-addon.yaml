{{ if .Values.pvc.enabled }}
apiVersion: addons.kubestash.com/v1alpha1
kind: Addon
metadata:
  name: 'pvc-addon'
  labels:
    {{- include "kubestash-catalog.labels" . | nindent 4 }}
spec:
  backupTasks:
  - driver: Restic
    executor: Job
    function: pvc-backup
    name: PhysicalBackup
    parameters:
    - name: paths
      required: true
      usage: List of file paths to backup.
    - name: exclude
      required: false
      usage: List of patterns for the files that should be ignored during backup.
    - default: "true"
      name: enableCache
      required: false
      usage: Enable or disable caching. Disabling caching may impact backup performance.
    - default: /kubestash-tmp/data
      name: scratchDir
      required: false
      usage: Directory for holding temporary files and restic cache.
    singleton: true
    volumeMounts:
    - mountPath: /kubestash-tmp
      name: temp-volume
    volumeTemplate:
    - name: temp-volume
      source:
        emptyDir: {}
      usage: Holds temporary files and restic cache.
  - driver: VolumeSnapshotter
    function: volume-snapshot-backup
    name: VolumeSnapshot
    parameters:
    - name: snapshotClassName
      required: false
      usage: The VolumeSnapshotClassName to be used by volumeSnapshot
    singleton: true
  restoreTasks:
  - driver: Restic
    executor: Job
    function: pvc-restore
    name: PhysicalBackupRestore
    parameters:
    - name: exclude
      required: false
      usage: List of patterns for the files that should be ignored during restore.
    - name: include
      required: false
      usage: List of patterns for the files that should be restored.
    - default: "true"
      name: enableCache
      required: false
      usage: Enable or disable caching. Disabling caching may impact backup performance.
    - default: /kubestash-tmp/data
      name: scratchDir
      required: false
      usage: Directory for holding temporary files and restic cache.
    singleton: true
    volumeMounts:
    - mountPath: /kubestash-tmp
      name: temp-volume
    volumeTemplate:
    - name: temp-volume
      source:
        emptyDir: {}
      usage: Holds temporary files and restic cache.
  - driver: VolumeSnapshotter
    function: volume-snapshot-restore
    name: VolumeSnapshotRestore
    singleton: true
{{ end }}

